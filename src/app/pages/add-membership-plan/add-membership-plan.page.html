<ion-header>
  <app-toolbar [role]="'owner'" [title]="'Add Memberships'" [showBackButton]="true"></app-toolbar>
</ion-header>
<ion-content class="ion-padding">
  <div class="form-container">
    
    <!-- Add Plan Button -->
    <div class="section-card">
      <ion-button expand="block" (click)="openModal()" class="add-plan-button">
        <ion-icon name="add-outline" slot="start"></ion-icon>
        Add Membership Plan
      </ion-button>
    </div>

    <!-- Existing Plans List -->
    <div class="section-card" *ngIf="existingPlans?.length">
      <div class="section-header">
        <ion-icon name="list-outline" color="dark"></ion-icon>
        <h2>Existing Plans</h2>
      </div>
      
      <div class="plans-grid">
        <div class="plan-card" *ngFor="let plan of existingPlans">
          <div class="plan-header">
            <h3>{{ plan.plan_name }}</h3>
            <ion-badge [color]="plan.is_active ? 'success' : 'medium'" class="status-badge">
              {{ plan.is_active ? 'Active' : 'Inactive' }}
            </ion-badge>
          </div>
          <div class="plan-content">
            <p class="plan-description">{{ plan.description }}</p>
            <div class="plan-details">
              <div class="detail-item">
                <ion-icon name="time-outline"></ion-icon>
                <span>{{ plan.duration_months }} months</span>
              </div>
              <div class="detail-item">
                <ion-icon name="cash-outline"></ion-icon>
                <span>{{ plan.price | currency }}</span>
              </div>
              <div class="detail-item">
                <ion-icon name="bookmark-outline"></ion-icon>
                <span>{{ plan.plan_type | titlecase }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div class="section-card empty-state" *ngIf="!existingPlans?.length">
      <ion-icon name="list-outline" size="large" color="medium"></ion-icon>
      <h3>No membership plans found</h3>
      <p>Create your first membership plan to get started</p>
    </div>
  </div>
</ion-content>

<!-- Modal Content -->
<ion-modal [isOpen]="isModalOpen">
  <ng-template>
    <ion-header>
      <ion-toolbar color="light">
        <ion-title color="dark">Create Membership Plan</ion-title>
        <ion-buttons slot="end">
          <ion-button (click)="closeModal()" color="dark">
            <ion-icon name="close-outline"></ion-icon>
          </ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-header>
    <ion-content class="ion-padding" color="light">
      <div class="modal-container">
        <form [formGroup]="membershipPlanForm" (ngSubmit)="onSubmit()">
          
          <div class="section-card">
            <div class="section-header">
              <ion-icon name="create-outline" color="dark"></ion-icon>
              <h2>Plan Information</h2>
            </div>
            
            <ion-list lines="none" class="form-list">
              <ion-item class="form-item">
                <ion-input 
                  label="Plan Name" 
                  labelPlacement="floating" 
                  formControlName="plan_name" 
                  type="text" 
                  required
                  class="custom-input">
                </ion-input>
                <ion-note slot="end" *ngIf="membershipPlanForm.get('plan_name')?.invalid && membershipPlanForm.get('plan_name')?.touched" color="danger">
                  Required (Max 100 chars)
                </ion-note>
              </ion-item>

              <ion-item class="form-item">
                <ion-textarea 
                  label="Description" 
                  labelPlacement="floating" 
                  formControlName="description" 
                  rows="3"
                  class="custom-input">
                </ion-textarea>
              </ion-item>

              <ion-item class="form-item">
                <ion-input 
                  label="Duration (Months)" 
                  labelPlacement="floating" 
                  formControlName="duration_months" 
                  type="number" 
                  required
                  class="custom-input">
                </ion-input>
                <ion-note slot="end" *ngIf="membershipPlanForm.get('duration_months')?.invalid && membershipPlanForm.get('duration_months')?.touched" color="danger">
                  Required (Positive integer)
                </ion-note>
              </ion-item>

              <ion-item class="form-item">
                <ion-input 
                  label="Price" 
                  labelPlacement="floating" 
                  formControlName="price" 
                  type="number" 
                  required
                  class="custom-input">
                </ion-input>
                <ion-note slot="end" *ngIf="membershipPlanForm.get('price')?.invalid && membershipPlanForm.get('price')?.touched" color="danger">
                  Required (Non-negative)
                </ion-note>
              </ion-item>

              <ion-item class="form-item">
                <ion-select 
                  label="Plan Type" 
                  labelPlacement="floating" 
                  formControlName="plan_type" 
                  required
                  class="custom-select">
                  <ion-select-option *ngFor="let type of planTypes" [value]="type">
                    {{ type | titlecase }}
                  </ion-select-option>
                </ion-select>
                <ion-note slot="end" *ngIf="membershipPlanForm.get('plan_type')?.invalid && membershipPlanForm.get('plan_type')?.touched" color="danger">
                  Required
                </ion-note>
              </ion-item>

              <ion-item class="form-item toggle-item">
                <ion-toggle formControlName="is_active" justify="space-between" color="dark">
                  Is Active?
                </ion-toggle>
              </ion-item>
            </ion-list>
          </div>

          <ion-button 
            expand="block" 
            type="submit" 
            [disabled]="membershipPlanForm.invalid"
            class="submit-button">
            <ion-icon name="checkmark-outline" slot="start"></ion-icon>
            Create Plan
          </ion-button>
        </form>
      </div>
    </ion-content>
  </ng-template>
</ion-modal>